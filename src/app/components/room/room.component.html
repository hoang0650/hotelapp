<div class="room-container">
  <!-- Header với bộ lọc phòng -->
  <div class="page-header">
    <div nz-row [nzGutter]="16">
      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="6">
        <nz-form-item>
          <nz-form-label>Khách sạn</nz-form-label>
          <nz-form-control>
            <nz-select 
              nzPlaceHolder="Chọn khách sạn" 
              [(ngModel)]="selectedHotelId" 
              (ngModelChange)="onHotelChange($event)"
              class="w-100">
              <nz-option *ngFor="let hotel of hotels" [nzValue]="hotel._id" [nzLabel]="hotel.name"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzXs]="12" [nzSm]="12" [nzMd]="8" [nzLg]="6">
        <nz-form-item>
          <nz-form-label>Tầng</nz-form-label>
          <nz-form-control>
            <nz-select 
              nzPlaceHolder="Chọn tầng" 
              [(ngModel)]="selectedFloor"
              (ngModelChange)="onFloorChange($event)"
              class="w-100"
              nzAllowClear>
              <nz-option *ngFor="let floor of floors" [nzValue]="floor" [nzLabel]="'Tầng ' + floor"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzXs]="12" [nzSm]="12" [nzMd]="8" [nzLg]="6">
        <nz-form-item>
          <nz-form-label>Hiển thị</nz-form-label>
          <nz-form-control>
            <div class="display-controls">
              <nz-slider 
                [nzMarks]="marksCount" 
                [nzStep]="null" 
                [nzMin]="2" 
                [nzMax]="12" 
                [(ngModel)]="count"
                (ngModelChange)="reGenerateArray($event)">
              </nz-slider>
            </div>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="6">
        <div class="action-buttons text-right">
          <button nz-button nzType="primary" (click)="openShiftHandoverModal()" title="Giao ca">
            <i nz-icon nzType="sync" nzTheme="outline"></i> Giao ca
          </button>
          
          <button nz-button nzType="default" (click)="showRoomHistory()" title="Lịch sử phòng" class="ml-2">
            <i nz-icon nzType="history" nzTheme="outline"></i> Lịch sử
          </button>
        </div>
      </div>
    </div>
    
    <!-- Legend -->
    <div nz-row>
      <div nz-col [nzSpan]="24">
        <div class="legend mt-2">
          <span class="legend-item">
            <span class="status-dot available"></span>
            <span>Trống</span>
          </span>
          <span class="legend-item">
            <span class="status-dot occupied"></span>
            <span>Đang sử dụng</span>
          </span>
          <span class="legend-item">
            <span class="status-dot dirty"></span>
            <span>Cần dọn dẹp</span>
          </span>
          <span class="legend-item">
            <span class="status-dot maintenance"></span>
            <span>Bảo trì</span>
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Hiển thị lưới phòng -->
  <div class="section-container room-grid mt-3">
    <nz-spin [nzSpinning]="isLoading">
      <div class="section-header" *ngIf="selectedFloor !== null">
        <h3>Danh sách phòng - Tầng {{ selectedFloor }}</h3>
      </div>
      
      <!-- Lưới phòng -->
      <div nz-row [nzGutter]="[hGutter, vGutter]">
        <div 
          nz-col 
          [nzXs]="24" 
          [nzSm]="12" 
          [nzMd]="24 / (count > 6 ? 6 : count)" 
          [nzLg]="24 / count" 
          *ngFor="let room of rooms"
          class="room-col">
          <div 
            class="room-item" 
            [ngClass]="getRoomStatusClass(room.roomStatus)"
            appModalControl 
            [room]="room">
            <div class="room-number">{{ room.roomNumber }}</div>
            <div class="room-floor">Tầng {{ room.floor }}</div>
            <div class="room-type">{{ room.roomType }}</div>
            <div class="room-status">{{ room.roomStatus }}</div>
          </div>
        </div>
      </div>
      
      <!-- Hiển thị khi không có phòng -->
      <div class="empty-state" *ngIf="rooms.length === 0 && !isLoading">
        <nz-empty 
          [nzNotFoundContent]="selectedHotelId ? 'Không tìm thấy phòng nào' : 'Vui lòng chọn khách sạn'"
          [nzNotFoundImage]="'simple'">
        </nz-empty>
      </div>
    </nz-spin>
  </div>
  
  <!-- Biểu đồ doanh thu -->
  <div class="section-container mt-4" *ngIf="selectedHotelId">
    <div class="section-header">
      <h3>Doanh thu khách sạn {{ selectedHotelId ? '- ' + getHotelName(selectedHotelId) : '' }}</h3>
    </div>
    <app-revenue-chart
      [hotelId]="selectedHotelId"
      [labels]="chartLabels"
      [revenueData]="chartRevenueData"
      [paymentData]="chartPaymentData"
      [totalRevenue]="totalPayment"
      [totalPayment]="totalPayment">
    </app-revenue-chart>
  </div>
  
  <!-- Bảng lịch sử phòng -->
  <div class="section-container mt-4" *ngIf="selectedHotelId">
    <div class="section-header">
      <h3>Lịch sử phòng {{ selectedHotelId ? '- ' + getHotelName(selectedHotelId) : '' }}</h3>
    </div>
    <app-table 
      [listOfData]="roomTableData" 
      [hotelId]="selectedHotelId"
      (onViewInvoice)="viewInvoice($event)">
    </app-table>
  </div>
</div>

<style>
  .room-container {
    padding: 16px;
  }
  
  .page-header {
    background-color: white;
    padding: 16px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09);
    margin-bottom: 16px;
  }
  
  .section-container {
    background-color: white;
    padding: 16px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09);
  }
  
  .section-header {
    margin-bottom: 16px;
    padding-bottom: 8px;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .section-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 500;
    color: rgba(0, 0, 0, 0.85);
  }
  
  .w-100 {
    width: 100%;
  }
  
  .mt-2 {
    margin-top: 8px;
  }
  
  .mt-3 {
    margin-top: 16px;
  }
  
  .mt-4 {
    margin-top: 24px;
  }
  
  .ml-2 {
    margin-left: 8px;
  }
  
  .text-right {
    text-align: right;
  }
  
  .action-buttons {
    margin-top: 28px; /* Căn chỉnh theo label và control */
  }
  
  .room-item {
    height: 120px;
    padding: 16px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    margin-bottom: 16px;
  }
  
  .room-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
  }
  
  .room-number {
    font-size: 24px;
    font-weight: bold;
  }
  
  .room-floor {
    font-size: 12px;
    margin-top: 4px;
  }
  
  .room-type {
    font-size: 14px;
    margin-top: 4px;
  }
  
  .room-status {
    font-size: 12px;
    margin-top: 4px;
  }
  
  .inactive-room {
    background-color: #52c41a;
    color: white;
  }
  
  .active-room {
    background-color: #f5222d;
    color: white;
  }
  
  .dirty-room {
    background-color: #fa8c16;
    color: white;
  }
  
  .maintenance-room {
    background-color: #722ed1;
    color: white;
  }
  
  .cleaning-room {
    background-color: #1890ff;
    color: white;
  }
  
  .empty-state {
    padding: 32px 0;
  }
  
  .legend {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
  }
  
  .legend-item {
    display: flex;
    align-items: center;
    font-size: 12px;
  }
  
  .status-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 4px;
  }
  
  .status-dot.available {
    background-color: #52c41a;
  }
  
  .status-dot.occupied {
    background-color: #f5222d;
  }
  
  .status-dot.dirty {
    background-color: #fa8c16;
  }
  
  .status-dot.maintenance {
    background-color: #722ed1;
  }
  
  /* Responsive styles */
  @media (max-width: 575px) {
    .room-item {
      height: 100px;
    }
    
    .room-number {
      font-size: 20px;
    }
    
    .legend {
      justify-content: space-between;
      gap: 8px;
    }
    
    .action-buttons {
      text-align: left;
      margin-top: 16px;
    }
  }
</style>
  