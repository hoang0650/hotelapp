<div class="pricing-container">
  <nz-spin [nzSpinning]="loading">
    <div class="pricing-header">
      <h1>Chọn gói dịch vụ phù hợp với bạn</h1>
      <div class="billing-toggle">
        <nz-radio-group [(ngModel)]="billingType">
          <label nz-radio-button value="monthly">Thanh toán theo tháng</label>
          <label nz-radio-button value="yearly">Thanh toán theo năm</label>
        </nz-radio-group>
      </div>
    </div>

    <div class="pricing-plans">
      <div *ngFor="let package of packages" class="pricing-plan" [class.current-plan]="isCurrentPackage(package.id)">
        <div class="plan-header">
          <h2>{{ package.name }}</h2>
          <div class="price">
            <span class="amount">{{ billingType === 'yearly' ? package.price * 12 * 0.9 : package.price | currency:'VND':'symbol':'1.0-0' }}</span>
            <span class="period">/{{ billingType === 'yearly' ? 'năm' : 'tháng' }}</span>
          </div>
          <p *ngIf="billingType === 'yearly'" class="savings">Tiết kiệm 10%</p>
        </div>

        <div class="plan-features">
          <ul>
            <li *ngFor="let feature of package.features">
              <i nz-icon nzType="check" nzTheme="outline"></i>
              {{ feature }}
            </li>
          </ul>
        </div>

        <div class="plan-footer">
          <ng-container *ngIf="userId; else loginButton">
            <ng-container *ngIf="isCurrentPackage(package.id); else subscribeButton">
              <button
                nz-button
                nzType="primary"
                nzDanger
                (click)="cancelSubscription()"
                [disabled]="package.name === 'FREE'">
                Hủy gói
              </button>
              <p class="current-plan-text">Gói hiện tại của bạn</p>
              <p *ngIf="currentPackage?.packageExpiryDate">
                Hết hạn: {{ currentPackage.packageExpiryDate | date:'dd/MM/yyyy' }}
              </p>
            </ng-container>
            <ng-template #subscribeButton>
              <button
                nz-button
                nzType="primary"
                [disabled]="isCurrentPackage(package.id) || loading"
                (click)="subscribeToPlan(package.id)">
                {{ isCurrentPackage(package.id) ? 'Đã đăng ký' : (loading ? 'Đang xử lý...' : 'Đăng ký') }}
              </button>
            </ng-template>
          </ng-container>
          <ng-template #loginButton>
            <button nz-button nzType="primary" (click)="redirectToLogin()">Đăng nhập để đăng ký gói</button>
          </ng-template>
        </div>
      </div>
    </div>
  </nz-spin>
</div> 