<nz-modal
  [(nzVisible)]="isVisible"
  nzTitle="Hóa đơn"
  [nzWidth]="800"
  (nzOnCancel)="handleCancel()"
  [nzFooter]="modalFooter"
>
  <ng-container *nzModalContent>
    <nz-spin [nzSpinning]="isLoading">
      <div class="invoice-container">
        <div class="header-container">
          <div class="left-section">
            <p>
              <strong>{{ invoiceData.businessName || 'Khách sạn' }}</strong>
            </p>
            <p>
              {{ invoiceData.business_address || 'Chưa có địa chỉ' }}
            </p>
            <p>
              ĐT: {{ invoiceData.phoneNumber || 'Chưa có số điện thoại' }}
            </p>
          </div>
          <div class="right-section">
            <p><strong>Số hóa đơn:</strong> {{ invoiceData.invoiceNumber || invoiceData.bookingId || 'N/A' }}</p>
            <p><strong>Ngày:</strong> {{ invoiceData.date | date:'dd/MM/yyyy HH:mm' }}</p>
            <nz-tag [nzColor]="invoiceData.paymentStatus === 'paid' ? 'warning' : 'success'">
              {{ invoiceData.paymentStatus === 'paid' ? 'Chờ thanh toán' : 'Đã thanh toán' }}
            </nz-tag>
          </div>
        </div>
        <div class="title-section">
          <h2>HOÁ ĐƠN THANH TOÁN</h2>
        </div>
        
        <div class="customer-info">
          <div class="info-card">
            <div class="info-row">
              <div class="info-item">
                <span><strong>Mã đặt phòng:</strong></span>
                <span>{{ invoiceData.bookingId || 'N/A' }}</span>
              </div>
              <div class="info-item">
                <span><strong>Khách hàng:</strong></span>
                <span>{{ invoiceData.customerName || (invoiceData.guestInfo ? invoiceData.guestInfo.name : '') || 'Khách lẻ' }}</span>
              </div>
            </div>
            <div class="info-row">
              <div class="info-item">
                <span><strong>Phòng:</strong></span>
                <span>{{ invoiceData.roomNumber }}</span>
              </div>
              <div class="info-item">
                <span><strong>Nhân viên:</strong></span>
                <span>{{ invoiceData.staffName || 'Không có thông tin' }}</span>
              </div>
            </div>
            <div class="info-row">
              <div class="info-item">
                <span><strong>Ngày đến:</strong></span>
                <span>{{ invoiceData.checkInTime | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
              <div class="info-item">
                <span><strong>Ngày đi:</strong></span>
                <span>{{ invoiceData.checkOutTime | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
            </div>
          </div>
        </div>
        
        <nz-table [nzData]="invoiceData.products || []" nzShowPagination="false" class="invoice-table">
          <thead>
            <tr>
              <th>Tên hàng</th>
              <th>Số lượng</th>
              <th>Đơn giá</th>
              <th>Thành tiền</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let product of invoiceData.products || []">
              <td>{{ product.name }}</td>
              <td class="text-center">x{{ product.quantity || 1 }}</td>
              <td class="text-right">{{ product.price | currency:'VND':'symbol-narrow':'1.0-0' }}</td>
              <td class="text-right">{{ (product.price * (product.quantity || 1)) | currency:'VND':'symbol-narrow':'1.0-0' }}</td>
            </tr>
            
            <!-- Hiển thị nếu không có sản phẩm -->
            <tr *ngIf="(invoiceData.products || []).length === 0">
              <td>Tiền phòng {{ invoiceData.roomNumber }}</td>
              <td class="text-center">x1</td>
              <td class="text-right">{{ invoiceData.amount | currency:'VND':'symbol-narrow':'1.0-0' }}</td>
              <td class="text-right">{{ invoiceData.amount | currency:'VND':'symbol-narrow':'1.0-0' }}</td>
            </tr>
            
            <!-- Tổng cộng -->
            <tr class="total-row">
              <td><strong>Tổng tiền:</strong></td>
              <td class="text-center"></td>
              <td class="text-center"></td>
              <td class="text-right">
                <p><strong>{{ invoiceData.amount | currency:'VND':'symbol-narrow':'1.0-0' }}</strong></p>
              </td>
            </tr>
          </tbody>
        </nz-table>

        <!-- Hiển thị ghi chú nếu có -->
        <div *ngIf="invoiceData.notes" class="notes">
          <p><strong>Ghi chú:</strong> {{ invoiceData.notes }}</p>
        </div>

        <div class="thank-you">
          <p>Cảm ơn quý khách đã sử dụng dịch vụ!</p>
          <p>Chúc quý khách một ngày tốt lành!</p>
        </div>
      </div>
    </nz-spin>
  </ng-container>
  
  <ng-template #modalFooter>
    <button nz-button nzType="default" (click)="handleCancel()">
      Đóng
    </button>
    <button nz-button nzType="primary" (click)="printInvoice()">
      <span nz-icon nzType="printer"></span> In hóa đơn
    </button>
    <button nz-button nzType="primary" nzDanger (click)="deleteInvoice()" nz-popconfirm nzPopconfirmTitle="Bạn chắc chắn muốn xóa?">
      <span nz-icon nzType="delete"></span> Xóa hóa đơn
    </button>
  </ng-template>
</nz-modal> 